{% extends 'base-advisor.html' %}

{% block title %}Elite Loans - Loan Predictions{% endblock %}

{% block content %}
<!-- Page Container -->

<section>
    <div class="container mx-auto px-6">
            <!-- Table Section -->
            <div class="overflow-hidden rounded-lg shadow-lg">
                <table class="w-full text-gray-900">
                    <thead class="bg-gray-900 text-white uppercase text-sm tracking-wider">
                        <tr>
                            <th class="py-4 px-6 text-left">ID</th>
                            <th class="py-4 px-6 text-left">Amount</th>
                            <th class="py-4 px-6 text-left">Duration</th>
                            <th class="py-4 px-6 text-left">NAICS</th>
                            <th class="py-4 px-6 text-left">Rural</th>
                            <th class="py-4 px-6 text-left">Franchise</th>
                            <th class="py-4 px-6 text-left">Employees</th>
                            <th class="py-4 px-6 text-left">Status</th>
                            <th class="py-4 px-6 text-left">Action</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for prediction in predictions %}
                        <tr class="bg-white hover:bg-gray-50">
                            <td class="py-4 px-6">{{ prediction.id }}</td>
                            <td class="py-4 px-6">${{ prediction.amount }}</td>
                            <td class="py-4 px-6">{{ prediction.term }} months</td>
                            <td class="py-4 px-6">{{ prediction.naics }}</td>
                            <td class="py-4 px-6">{{ prediction.rural }}</td>
                            <td class="py-4 px-6">{{ prediction.franchise }}</td>
                            <td class="py-4 px-6">{{ prediction.no_emp }}</td>
                            <td class="py-4 px-6 font-semibold" id="status-{{ prediction.id }}">{{ prediction.status }}</td>
                            <td class="py-4 px-6">
                                {% if prediction.status == "pending" %}
                                    <button class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition" onclick="updateStatus({{ prediction.id }}, 'approved')">Approve</button>
                                    <button class="bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 transition ml-2" onclick="updateStatus({{ prediction.id }}, 'rejected')">Reject</button>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="9" class="py-6 text-center text-gray-500">No loan predictions available.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<script>
    function updateStatus(predictionId, status) {
        fetch(`/update_prediction/${predictionId}/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ status: status })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                let statusCell = document.getElementById("status-" + predictionId);
                statusCell.innerText = status;
                statusCell.classList.add(status === 'approved' ? 'text-green-600' : 'text-red-600');
                statusCell.nextElementSibling.innerHTML = "";
            } else {
                alert("Error updating status!");
            }
        });
    }
</script>

{% endblock %}
